# 변경 사항 요약 (취약점 점검 #1 ~ #7 및 추가 패치)

`취약점 점검#1` 부터 `사용자 동의 모달 닫기 방지` 커밋까지의 모든 변경 사항을 검토 및 정리하였습니다.

## 전체 커밋 리스트 및 주요 변경 내용

### 1. 취약점 점검 #1 (Commit: `2c8c04c2c`)
*   **초기 점검 시작점**: 전체적인 취약점 점검을 위한 베이스 커밋입니다.

### 2. 취약점 점검 #2 (Commit: `6123e56c5`)
*   **보안 변경 기록 관리**: `CHANGELOG_SECURITY.md` 파일이 추가되었습니다. 보안 관련 업데이트를 별도로 추적하기 시작했습니다.

### 3. 취약점 점검 #3 (Commit: `a5955a4f0`)
*   **문서 파싱 호환성 강화**: Dockerfile에 `msoffcrypto-tool`, `chardet`, `nltk`, `pyhwp` 등의 파이썬 패키지 설치가 추가되었습니다. 암호화된 문서나 다양한 인코딩의 파일 처리를 위한 의존성입니다.

### 4. 취약점 점검 #4 (Commit: `5759a7eb4`)
*   **JTI (JWT ID) 도입**: DB 마이그레이션(`add_token_jti_to_auth.py`)을 통해 인증 토큰 관리를 위한 데이터베이스 구조가 변경되었습니다. 이는 서버 측에서 특정 토큰을 즉시 무효화하기 위한 기반 작업입니다.

### 5. 취약점 점검 #5 (Commit: `453924007`)
*   **Session Storage 마이그레이션**:
    *   **내용**: 클라이언트 사이드 토큰 저장소를 `localStorage`에서 `sessionStorage`로 전면 교체하였습니다.
    *   **영향 범위**: `src/lib` 및 `src/routes` 내의 모든 API 호출 및 소켓 연결 로직 (약 120개 파일 수정).
    *   **목적**: 브라우저 종료 시 세션이 즉시 만료되도록 하여 보안성을 높였습니다.

### 6. 취약점 점검 #6 (Commit: `1da45db0e`)
*   **관리자 패널 차단 (Disable Admin)**:
    *   **내용**: `DISABLE_ADMIN` 환경변수(기본값: False)를 통해 관리자 기능을 원천 차단하는 기능이 추가되었습니다.
    *   **구현**:
        *   `backend/open_webui/env.py`: 환경변수 로드.
        *   `backend/open_webui/utils/auth.py`: `get_admin_user` 함수에서 차단 로직 수행 (403 Forbidden).
        *   `src/routes/(app)/admin/+layout.svelte`: 프론트엔드 관리자 페이지 접근 시 메인으로 리다이렉트.

### 7. 취약점 점검 #7 (Commit: `4be37956d`)
*   **세션 타임아웃 및 글로벌 보안 처리**:
    *   **세션 타임아웃 모달**: `SessionTimeoutModal.svelte`가 추가되어 세션 만료 임박 시 사용자에게 경고하고 연장을 유도합니다.
    *   **글로벌 401 인터셉터**: `src/routes/+layout.svelte`에서 모든 fetch 요청을 감시하며 401 에러 발생 시 즉시 로그아웃 처리합니다.
    *   **Chat Deletion (채팅 삭제)**: `main.py`에 주기적인 채팅 삭제 로직이 통합되었습니다 (이전 커밋들과의 통합 작업으로 추정).

### 8. 사용자 동의 모달 닫기 방지 (Commit: `9e5b98126`)
*   **내용**: `src/lib/components/common/Modal.svelte` 수정.
*   **목적**: 필수 약관 동의 등 중요한 모달의 경우, 배경 클릭이나 ESC 키로 닫히지 않도록 강제하는 옵션이 추가되었습니다.

---

## 요약 (기능별)

1.  **토큰 보안**: `localStorage` -> `sessionStorage` 전면 전환 (#5), JTI 도입 (#4).
2.  **세션 관리**: 세션 타임아웃 경고 모달 (#7), 401 에러 시 강제 로그아웃 (#7).
3.  **데이터 정책**: 채팅 자동 삭제 (#7 포함).
4.  **시스템 보안**: 관리자 패널 비활성화 옵션 추가 (#6), 문서 파싱 라이브러리 추가 (#3).
5.  **UX 제어**: 필수 모달 닫기 방지 (#Modal Fix).
